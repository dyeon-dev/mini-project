<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>수입 내역</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<style>
  /* 사이드바 래퍼 스타일 */
  #page-wrapper {
    padding-left: 250px;
  }
  #sidebar-wrapper {
    position: fixed;
    width: 250px;
    height: 100%;
    margin-left: -250px;
    background: #000;
    overflow-x: hidden;
    overflow-y: auto;
  }
  #page-content-wrapper {
    width: 100%;
    padding: 20px;
  }
  /* 사이드바 스타일 */
  .sidebar-nav {
    width: 250px;
    margin: 0;
    padding: 0;
    list-style: none;
  }
  .sidebar-nav li {
    text-indent: 1.5em;
    line-height: 2.8em;
  }
  .sidebar-nav li a {
    display: block;
    text-decoration: none;
    color: #999;
  }
  .sidebar-nav li a:hover {
    color: #fff;
    background: rgba(255, 255, 255, 0.2);
  }
  .sidebar-nav > .sidebar-brand {
    font-size: 1.3em;
    line-height: 3em;
  }
</style>

<link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="fonts/icomoon/style.css">
<link rel="stylesheet" href="css/rome.css">
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="css/bootstrap.min.css">
<!-- Style -->
<link rel="stylesheet" href="css/style.css">

</head>
<body>
  <div id="page-wrapper">
    <!-- 사이드바 -->
    <div id="sidebar-wrapper">
      <ul class="sidebar-nav">
        <li class="sidebar-brand">
          <a href="home.html">Smart 가계부</a>
        </li>
        <li><a href="list.html">수입 내역</a></li>
        <li><a href="list2.html">지출 내역</a></li>
        <br />
        <li><a href="#">수입 / 지출 그래프</a></li>
        <li><a href="#">용도별 그래프</a></li>
        <br />
        <li><a href="#">챌린지</a></li>
      </ul>
    </div>
    <!-- /사이드바 -->

    <!-- 본문 -->
    <div id="page-content-wrapper">
      <div class="container-fluid">
        <h1>수입 내역</h1>
        <!-- 모달 창 -->
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@mdo">추가</button>
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">수입 내역 추가</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="income_form">
                  <div class="mb-3">
                    <label for="recipient-name" class="col-form-label">메모</label>
                    <input type="text" name="title" class="form-control" id="in_title">
                  </div>
                  <div class="mb-3">
                    <label for="message-text" class="col-form-label">금액</label>
                    <input class="form-control" name="price" id="in_price"></input>
                  </div>
                  <div class="mb-3">
                    <label for="date" class="col-form-label">날짜</label>
                    <input type="text" name="result" class="form-control w-25 mx-auto mb-3" placeholder="Select date" id="result" readonly>
                    <div id="inline_cal"></div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                <button type="button" id="submit_form" class="btn btn-primary">등록</button>
              </div>
            </div>
          </div>
        </div>
        <!-- /모달창 -->

        <!-- 테이블 -->
        <table class="table caption-top">
          <thead>
            <tr>
              <th scope="col">No</th>
              <th scope="col">날짜</th>
              <th scope="col">메모</th>
              <th scope="col">금액</th>
              <th scope="col">수정/삭제</th>
            </tr>
          </thead>
          <tbody id="ys_body">
          </tbody>
        </table>
        <!-- /테이블 -->
      </div>
    </div>
    <!-- /본문 -->
  </div>

  <!-- 모달창 js -->
  <script src="js/jquery-3.3.1.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/rome.js"></script>
  <script src="js/main.js"></script>
  <!-- /모달창 js -->

  <script type="text/javascript">
    $(document).ready(function(){
      $.ajax({
        url: "/income/list",
        success: function(data){
          let s = "";
          for(let d of data){
            s += "<tr>";
            s += "<td><a href='detail.html?no=" + d.no + "'>" + d.no + "</a></td>";
            s += "<td><a href='detail.html?no=" + d.no + "'>" + d.indate + "</a></td>";
            s += "<td><a href='detail.html?no=" + d.no + "'>" + d.title + "</a></td>";
            s += "<td><a href='detail.html?no=" + d.no + "'>" + d.price + "</a></td>";
            s += "</tr>";
          }
          $("#ys_body").html(s);
        }
      });

      var exampleModal = document.getElementById('exampleModal');
      exampleModal.addEventListener('show.bs.modal', function(event){
        var button = event.relatedTarget;
      });

      $("#submit_form").click(function(){
        $("#result").prop('readonly', false);  // 폼 제출 전에 필드를 활성화
        $("#income_form").submit();
      });

      $("#income_form").submit(function(event){
        event.preventDefault();
        // alert($("#income_form").serialize());
        $.ajax({
          url: "/income/regist",
          type: "POST",
          data: {
            title: $("#in_title").val(),
            date: $("#result").val(),
            price: $("#in_price").val()
          },
          success: function(data){
            if(data.code == "ok"){
              location.href = "list.html";
            }
          }
        });
      });
	  rome(inline_cal, {time: false, inputFormat: 'MMMM DD, YYYY'}).on('data', function (value) {
	    let date = new Date(value);
	    let day = ('0' + date.getDate()).slice(-2);
	    let month = ('0' + (date.getMonth() + 1)).slice(-2); // Months are zero based
	    let year = date.getFullYear();
	    let isoDate = year + '-' + month + '-' + day;
	    $("#result").val(isoDate);
	  });
    });
  </script>
</body>
</html>
